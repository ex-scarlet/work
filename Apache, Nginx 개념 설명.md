웹 서버의 종류
==============
### 소개
오늘은 가장 대중적으로 사용되는 Web Server인 Apache, Nginx에 대해 알아보도록 하겠습니다.

### Apache Web Server

가장 대표적인 HTTP Server인 Apache는 1995년 이후 점유율 1위를 굳건히 차지하고 있었으나, 2020년부터 빠른 속도를 내세운 Nginx에게 밀리게 되었습니다.

### Apache의 처리 방식(커넥션 기반)

아파치는 Multi-Process Module 방식을 사용합니다.
- 클라이언트로부터 하나의 요청이 들어오게되면 하나의 프로세스를 생성해서 연결합니다
- 이러한 방식은 __확장성면에서 큰 장점__ 을 가집니다.
- 하나의 요청만을 처리함으로서 자체적으로 __동적인 처리__ 도 가능해집니다.
- 클라이언트 요청을 처리하기 위해 멀티 스레드 방식을 따릅니다.
- 프로세스 중심 접금 방식으로 클라이언트 요청을 제공해줍니다.
 
하지만 스마트폰이 등장하고 트래픽이 점점 많아지면 일정 수준 이상의 연결 프로세스를 만들지 못하거나 혹은 처리가 매우 느려지는 현상이 발생합니다.  
__C10K__ 라고도 불리는 이 증상은 __Connection 10000 Problem__ 이라는 이름으로도 불리며 10,000개의 요청이 들어왔을 때 발생하는 문제라고 합니다.  
(클라이언트 요청이 들어왔을 때마다 프로세스를 만드는 Apache 구조 상 CPU/메모리 사용률이 증가하여 대용량 처리 에러가 많이 발생합니다.)

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

### Nginx Web server

아파치에서 골칫거리였던 대규모 연결 처리를 위한 Nginx가 등장했는데 출시 당시에는 Apache 대체 프로그램이 아닌 Apache 앞단에서 사용되며  
Apache가 감당하기 힘들었던 대용량 트래픽(과부하)에 대한 동시 연결을 지원하는 프로그램이었습니다.  
하지만 Nginx도 웹서버로써 스스로 정적인 데이터들을 처리할 수 있었고 동시에 동적인 컨텐츠 요청들만 뒤로 넘기며 웹 컨테이너에게 처리를 요청하고 받을 수 있었습니다.  

### Nginx 처리 방식(이벤트 기반)

Nginx는 Apache와 다르게 하나의 요청을 받고도 여러개의 요청을 하나의 Worker process가 받을 수 있습니다.
(먼저 연결된 클라이언트에 요청이 없으면 Keep-Alive를 통해 연결은 끊지 않고 추가적인 요청을 대기하면서 다른 클라이언트의 요청을 받습니다.)

- Nginx도 master process를 본따서 worker process를 생성합니다.
- Worker process가 대기 -> 클라이언트로부터 요청이 들어왔을 때 부터 연결되어 동작을 시작합니다.
- 이벤트 중심 접근 방식으로 클라이언트 요청을 처리합니다.
- 비동기적 처리가 유연해 제한된 자원으로도 여러 요청을 동시에 효율적으로 처리할 수 있습니다.
- 최소한의 자원만으로도 웹 서버의 아키텍처를 개선하기 위한 독립적 HTTP 서버로 배치할 수 있습니다.

클라이언트에서 온 하나의 요청을 Event라고 하며 이 요청을 OS 커널이 큐 형식으로 worker process에 하나씩 넣어서 순차적으로 처리합니다.   
이 때, 오래 걸리는 작업들은 따로 빼서 처리합니다.(blocking)

그러나, 동적인 컨텐츠는 처리할 수 없어 이를 처리해주기 위해 외부 프로세서로 요청을 전달해주고, 렌더링 된 컨테츠를 전송받을 때까지 기다려 주어야 합니다.  
그래서 __프로세스 속도 저하__ 가 발생할 수 있습니다.


